<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lumina Optics | Luxury Eyewear Boutique</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Tailwind Configuration for Custom Colors (Mapped to CSS Variables) -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        luxury: {
                            base: 'var(--color-base)',
                            surface: 'var(--color-surface)',
                            primary: 'var(--color-primary)',
                            accent: 'var(--color-accent)',
                            secondary: 'var(--color-secondary)',
                            text: 'var(--color-text)',
                        }
                    },
                    fontFamily: {
                        serif: ['Georgia', 'serif'],
                        sans: ['Helvetica Neue', 'Arial', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    
    <style>
        /* CSS Variables for Light/Dark Mode Palette */
        :root {
            --color-base: #F9F8F6;       /* Warm off-white */
            --color-surface: #FFFFFF;    /* Pure white for cards */
            --color-primary: #2C2C2C;    /* Soft charcoal */
            --color-accent: #D4AF37;     /* Muted Gold */
            --color-secondary: #E5E2DD;  /* Stone beige / Borders */
            --color-text: #4A4A4A;       /* Dark gray text */
        }

        html.dark {
            --color-base: #121212;       /* Deep obsidian/black */
            --color-surface: #1E1E1E;    /* Elevated dark gray for cards */
            --color-primary: #F9F8F6;    /* Off-white for headings/strong text */
            --color-accent: #E5C158;     /* Slightly brighter gold for contrast */
            --color-secondary: #2C2C2C;  /* Charcoal / Borders */
            --color-text: #B0B0B0;       /* Light gray for readable body text */
        }

        /* Prevent FOUC (Flash of Unstyled Content) during theme load */
        html { transition: background-color 0.3s ease, color 0.3s ease; }
        body { transition: background-color 0.3s ease, color 0.3s ease; }

        /* Custom Scrollbar for luxury feel */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--color-base); }
        ::-webkit-scrollbar-thumb { background: var(--color-accent); border-radius: 4px; }

        /* Transition Utilities */
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>

    <!-- Early Theme Initialization to prevent flickering -->
    <script>
        if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
    </script>
</head>
<body class="bg-luxury-base text-luxury-primary font-sans antialiased min-h-screen flex flex-col transition-colors duration-300">

    <!-- Navigation -->
    <nav class="sticky top-0 z-50 bg-luxury-base/95 backdrop-blur-sm border-b border-luxury-secondary shadow-sm transition-colors duration-300">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-20">
                <!-- Logo -->
                <div class="flex-shrink-0 flex items-center cursor-pointer" onclick="navigateTo('home')">
                    <span class="font-serif text-2xl tracking-widest font-bold text-luxury-primary transition-colors">LUMINA</span>
                    <span class="text-luxury-accent text-3xl ml-1 transition-colors">.</span>
                </div>
                
                <!-- Desktop Menu -->
                <div class="hidden md:flex space-x-8 items-center">
                    <button onclick="navigateTo('home')" class="text-luxury-text hover:text-luxury-accent transition-colors duration-300 font-medium tracking-wide">HOME</button>
                    <button onclick="navigateTo('shop')" class="text-luxury-text hover:text-luxury-accent transition-colors duration-300 font-medium tracking-wide">COLLECTION</button>
                    <button onclick="navigateTo('stylist')" class="text-luxury-accent hover:text-luxury-primary transition-colors duration-300 font-medium tracking-wide flex items-center gap-1">‚ú® AI STYLIST</button>
                    <button onclick="navigateTo('about')" class="text-luxury-text hover:text-luxury-accent transition-colors duration-300 font-medium tracking-wide">OUR STORY</button>
                    <button onclick="navigateTo('cart')" class="text-luxury-text hover:text-luxury-accent transition-colors duration-300 font-medium tracking-wide relative">
                        CART
                        <span class="cart-count-badge absolute -top-2 -right-3 bg-luxury-accent text-white text-[10px] w-4 h-4 rounded-full flex items-center justify-center hidden">0</span>
                    </button>
                    <!-- Desktop Theme Toggle -->
                    <button onclick="toggleTheme()" class="text-luxury-text hover:text-luxury-accent transition-colors duration-300 focus:outline-none ml-4" aria-label="Toggle Dark Mode">
                        <span id="theme-icon-desktop"></span>
                    </button>
                </div>

                <!-- Mobile Menu Button -->
                <div class="md:hidden flex items-center gap-4">
                    <!-- Mobile Theme Toggle -->
                    <button onclick="toggleTheme()" class="text-luxury-primary hover:text-luxury-accent focus:outline-none p-2 transition-colors" aria-label="Toggle Dark Mode">
                        <span id="theme-icon-mobile"></span>
                    </button>
                    <button onclick="navigateTo('cart')" class="text-luxury-primary relative transition-colors">
                        CART
                        <span class="cart-count-badge absolute -top-2 -right-3 bg-luxury-accent text-white text-[10px] w-4 h-4 rounded-full flex items-center justify-center hidden">0</span>
                    </button>
                    <button onclick="toggleMobileMenu()" class="text-luxury-primary hover:text-luxury-accent focus:outline-none p-2 transition-colors">
                        <span class="text-2xl">&#9776;</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Mobile Menu (Hidden by default) -->
        <div id="mobile-menu" class="hidden md:hidden absolute w-full bg-luxury-base border-t border-luxury-secondary shadow-xl z-40 left-0 transition-colors duration-300">
            <div class="px-4 pt-2 pb-6 space-y-1">
                <button onclick="navigateTo('home'); toggleMobileMenu()" class="block w-full text-left px-4 py-4 text-luxury-text hover:bg-luxury-secondary hover:text-luxury-primary rounded-md text-lg font-medium border-b border-luxury-secondary/30 transition-colors">Home</button>
                <button onclick="navigateTo('shop'); toggleMobileMenu()" class="block w-full text-left px-4 py-4 text-luxury-text hover:bg-luxury-secondary hover:text-luxury-primary rounded-md text-lg font-medium border-b border-luxury-secondary/30 transition-colors">Collection</button>
                <button onclick="navigateTo('stylist'); toggleMobileMenu()" class="block w-full text-left px-4 py-4 text-luxury-accent hover:bg-luxury-secondary hover:text-luxury-primary rounded-md text-lg font-medium border-b border-luxury-secondary/30 transition-colors">‚ú® AI Stylist</button>
                <button onclick="navigateTo('about'); toggleMobileMenu()" class="block w-full text-left px-4 py-4 text-luxury-text hover:bg-luxury-secondary hover:text-luxury-primary rounded-md text-lg font-medium transition-colors">Our Story</button>
                
                <!-- Mobile Cart Button (Only visible when items are in cart) -->
                <button id="mobile-cart-menu-item" onclick="navigateTo('cart'); toggleMobileMenu()" class="hidden w-full text-left px-4 py-4 text-luxury-primary bg-luxury-secondary/30 hover:bg-luxury-secondary rounded-md text-lg font-bold border-t border-luxury-secondary/50 transition-colors justify-between items-center mt-2">
                    <span>View Cart</span>
                    <span id="mobile-cart-count" class="bg-luxury-accent text-white text-[12px] px-2.5 py-0.5 rounded-full">0</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content Area -->
    <main id="app-content" class="flex-grow w-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 transition-colors duration-300">
        <!-- Content injected via JS -->
    </main>

    <!-- Footer -->
    <footer class="bg-luxury-surface text-luxury-text py-12 mt-auto border-t border-luxury-secondary transition-colors duration-300">
        <div class="max-w-7xl mx-auto px-4 grid grid-cols-1 md:grid-cols-3 gap-8 text-sm">
            <div>
                <h3 class="font-serif text-lg text-luxury-accent mb-4 transition-colors">LUMINA.</h3>
                <p class="opacity-80 leading-relaxed">Curating the world's finest eyewear for the discerning individual. Trust, passion, and visionary design.</p>
            </div>
            <div>
                <h3 class="font-bold mb-4 tracking-wider text-luxury-primary transition-colors">VISIT US</h3>
                <p class="opacity-80">123 Visionary Way</p>
                <p class="opacity-80">Design District, NY 10012</p>
                <p class="opacity-80 mt-2">+1 (555) 019-2024</p>
            </div>
            <div>
                <h3 class="font-bold mb-4 tracking-wider text-luxury-primary transition-colors">HOURS</h3>
                <div class="flex justify-between max-w-xs opacity-80">
                    <span>Mon - Fri</span>
                    <span>10:00 - 19:00</span>
                </div>
                <div class="flex justify-between max-w-xs opacity-80 mt-1">
                    <span>Sat</span>
                    <span>11:00 - 18:00</span>
                </div>
            </div>
        </div>
        <div class="text-center text-xs opacity-50 mt-12 pt-8 border-t border-luxury-secondary transition-colors">
            &copy; 2026 Lumina Optics. All Rights Reserved.
        </div>
    </footer>

    <!-- Toast Notification Container -->
    <div id="toast-container" class="fixed bottom-5 right-5 z-50 flex flex-col gap-3"></div>

    <!-- JavaScript Application Logic -->
    <script>
        // --- DATA STORE ---
        
        // Products Database
        const products = [
            { id: 1, brand: 'ic! berlin', name: 'The Haptic', type: 'Optical', color: 'Black', price: 540, weight: 14, material: 'Stainless Steel', imageColor: '#2C2C2C' },
            { id: 2, brand: 'ic! berlin', name: 'Urban Pulse', type: 'Sunglasses', color: 'Gold', price: 620, weight: 16, material: 'Stainless Steel', imageColor: '#D4AF37' },
            { id: 3, brand: 'Tom Ford', name: 'FT5532', type: 'Optical', color: 'Tortoise', price: 495, weight: 28, material: 'Acetate', imageColor: '#5C4033' },
            { id: 4, brand: 'Tom Ford', name: 'Snowdon', type: 'Sunglasses', color: 'Black', price: 450, weight: 32, material: 'Acetate', imageColor: '#1A1A1A' },
            { id: 5, brand: 'Talla', name: 'Geometrico', type: 'Optical', color: 'Silver', price: 480, weight: 18, material: 'Titanium', imageColor: '#C0C0C0' },
            { id: 6, brand: 'Talla', name: 'Sun Architect', type: 'Sunglasses', color: 'Blue', price: 510, weight: 20, material: 'Titanium', imageColor: '#4682B4' },
            { id: 7, brand: 'Orgreen', name: 'Quantum High', type: 'Optical', color: 'Blue', price: 580, weight: 12, material: 'Titanium', imageColor: '#1E3A8A' },
            { id: 8, brand: 'Orgreen', name: 'Nordic Light', type: 'Sunglasses', color: 'Silver', price: 610, weight: 15, material: 'Polyamide', imageColor: '#A0AEC0' },
            { id: 9, brand: 'ic! berlin', name: 'Silk Collection', type: 'Optical', color: 'Gold', price: 590, weight: 11, material: 'Stainless Steel', imageColor: '#C5A000' },
            { id: 10, brand: 'Tom Ford', name: 'Blue Block', type: 'Optical', color: 'Black', price: 420, weight: 30, material: 'Acetate', imageColor: '#000000' },
            { id: 11, brand: 'Orgreen', name: 'Havana Nights', type: 'Sunglasses', color: 'Tortoise', price: 550, weight: 19, material: 'Titanium', imageColor: '#8B4513' },
            { id: 12, brand: 'Talla', name: 'Modernist', type: 'Optical', color: 'Tortoise', price: 460, weight: 22, material: 'Acetate', imageColor: '#6F4E37' }
        ];

        // State Management
        let appState = {
            currentPage: 'home',
            filters: {
                brand: 'All',
                color: 'All',
                type: 'All'
            },
            sortBy: 'featured',
            cart: []
        };

        // Gemini API Setup
        const apiKey = "";

        // --- THEME LOGIC ---
        function toggleTheme() {
            const html = document.documentElement;
            if (html.classList.contains('dark')) {
                html.classList.remove('dark');
                localStorage.setItem('theme', 'light');
            } else {
                html.classList.add('dark');
                localStorage.setItem('theme', 'dark');
            }
            updateThemeIcons();
        }

        function updateThemeIcons() {
            const isDark = document.documentElement.classList.contains('dark');
            const sunSvg = `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>`;
            const moonSvg = `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>`;
            
            document.getElementById('theme-icon-desktop').innerHTML = isDark ? sunSvg : moonSvg;
            document.getElementById('theme-icon-mobile').innerHTML = isDark ? sunSvg : moonSvg;
        }

        // --- NAVIGATION LOGIC ---

        function navigateTo(pageId) {
            appState.currentPage = pageId;
            const contentDiv = document.getElementById('app-content');
            
            // Fade out effect
            contentDiv.style.opacity = '0';
            
            setTimeout(() => {
                renderPage(pageId);
                window.scrollTo(0, 0);
                contentDiv.style.opacity = '1';
                contentDiv.style.transition = 'opacity 0.3s ease-in';
            }, 200);
        }

        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            menu.classList.toggle('hidden');
        }

        function renderPage(pageId) {
            const contentDiv = document.getElementById('app-content');
            contentDiv.innerHTML = ''; // Clear current content

            switch(pageId) {
                case 'home':
                    renderHome(contentDiv);
                    break;
                case 'shop':
                    renderShop(contentDiv);
                    break;
                case 'stylist':
                    renderStylist(contentDiv);
                    break;
                case 'about':
                    renderAbout(contentDiv);
                    break;
                case 'cart':
                    renderCart(contentDiv);
                    break;
                default:
                    renderHome(contentDiv);
            }
        }

        // --- PAGE RENDERERS ---

        function renderHome(container) {
            container.innerHTML = `
                <!-- Hero Section -->
                <section class="relative bg-luxury-surface rounded-xl overflow-hidden shadow-lg mb-16 fade-in border border-luxury-secondary transition-colors duration-300">
                    <div class="absolute inset-0 bg-gradient-to-r from-luxury-primary/10 to-transparent"></div>
                    <div class="relative z-10 px-8 py-24 md:py-32 flex flex-col items-start justify-center text-center md:text-left">
                        <h2 class="font-serif text-xl text-luxury-accent tracking-widest mb-4">EST. 2005</h2>
                        <h1 class="font-serif text-4xl md:text-6xl text-luxury-primary font-bold mb-6 leading-tight transition-colors">
                            Clarify Your<br/>Perspective.
                        </h1>
                        <p class="text-luxury-text text-lg mb-8 max-w-lg transition-colors">
                            Discover an exclusive curation of the world's finest optical engineering. 
                            Featuring ic! berlin, Tom Ford, and more.
                        </p>
                        <button onclick="navigateTo('shop')" class="bg-luxury-primary text-luxury-base px-8 py-4 rounded-sm hover:bg-luxury-accent hover:text-white transition-colors duration-300 tracking-wider font-bold shadow-md">
                            EXPLORE THE COLLECTION
                        </button>
                    </div>
                    <!-- Decorative Circle representing a lens -->
                    <div class="absolute -right-20 -bottom-40 w-96 h-96 rounded-full border-[30px] border-luxury-secondary opacity-30 hidden md:block transition-colors"></div>
                </section>

                <!-- Featured Brands Strip -->
                <section class="mb-20 text-center fade-in">
                    <p class="text-sm font-bold tracking-widest text-luxury-text opacity-50 mb-8 uppercase transition-colors">Our Partners</p>
                    <div class="flex flex-wrap justify-center gap-12 md:gap-24 opacity-60 grayscale hover:grayscale-0 transition-all duration-500 text-luxury-primary">
                        <div class="text-xl font-bold font-serif">ic! berlin</div>
                        <div class="text-xl font-bold font-serif">TOM FORD</div>
                        <div class="text-xl font-bold font-serif">TALLA</div>
                        <div class="text-xl font-bold font-serif">√òRGREEN</div>
                    </div>
                </section>

                <!-- Featured Products Preview -->
                <section class="mb-16 fade-in">
                    <div class="flex justify-between items-end mb-8">
                        <div>
                            <h2 class="text-3xl font-serif text-luxury-primary mb-2 transition-colors">Curated Highlights</h2>
                            <p class="text-luxury-text opacity-80 text-sm max-w-md transition-colors">Handpicked frames that define the season's aesthetic.</p>
                        </div>
                        <button onclick="navigateTo('shop')" class="text-luxury-accent hover:text-luxury-primary font-bold text-sm tracking-wide border-b border-luxury-accent pb-1 transition-colors">VIEW ALL</button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        ${products.slice(0, 3).map(product => createProductCard(product)).join('')}
                    </div>
                </section>
                
                <!-- CTA Banner -->
                <section class="bg-luxury-surface border border-luxury-secondary p-12 rounded-xl text-center md:flex md:justify-between md:items-center fade-in transition-colors duration-300 shadow-sm">
                    <div class="md:text-left mb-6 md:mb-0">
                        <h3 class="text-2xl font-serif mb-2 text-luxury-primary transition-colors">Not sure what fits?</h3>
                        <p class="text-luxury-text opacity-80 transition-colors">Consult our AI Stylist to find the perfect frame for your face shape and lifestyle.</p>
                    </div>
                    <button onclick="navigateTo('stylist')" class="border border-luxury-accent text-luxury-accent px-8 py-3 rounded-sm hover:bg-luxury-accent hover:text-white transition-all duration-300">
                        CONSULT AI STYLIST ‚ú®
                    </button>
                </section>
            `;
        }

        function renderShop(container) {
            // Filter Logic
            let filteredProducts = products.filter(p => {
                return (appState.filters.brand === 'All' || p.brand === appState.filters.brand) &&
                       (appState.filters.color === 'All' || p.color === appState.filters.color) &&
                       (appState.filters.type === 'All' || p.type === appState.filters.type);
            });

            // Sort Logic
            if (appState.sortBy === 'priceAsc') {
                filteredProducts.sort((a, b) => a.price - b.price);
            } else if (appState.sortBy === 'priceDesc') {
                filteredProducts.sort((a, b) => b.price - a.price);
            } else if (appState.sortBy === 'az') {
                filteredProducts.sort((a, b) => a.name.localeCompare(b.name));
            }

            // Extract unique options for filters
            const brands = ['All', ...new Set(products.map(p => p.brand))];
            const colors = ['All', ...new Set(products.map(p => p.color))];
            const types = ['All', ...new Set(products.map(p => p.type))];

            container.innerHTML = `
                <div class="mb-8 text-center fade-in px-4">
                    <h1 class="text-3xl md:text-4xl font-serif text-luxury-primary mb-4 transition-colors">The Collection</h1>
                    <p class="text-luxury-text max-w-2xl mx-auto text-sm md:text-base opacity-80 transition-colors">
                        Browse our extensive catalog of premium eyewear. Use the filters below to refine your search by brand, aesthetic, or function.
                    </p>
                </div>

                <div class="flex flex-col lg:flex-row gap-8 fade-in">
                    <!-- Mobile Filter Toggle -->
                    <div class="lg:hidden px-4 w-full">
                        <button onclick="toggleMobileFilters()" class="w-full border border-luxury-primary text-luxury-primary py-3 text-sm uppercase font-bold flex justify-center items-center gap-2 hover:bg-luxury-primary hover:text-luxury-base transition-colors duration-300 rounded-sm">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"></path></svg>
                            <span>Filters & Sort</span>
                        </button>
                    </div>

                    <!-- Sidebar Filters -->
                    <aside id="shopFilters" class="hidden lg:block w-full lg:w-1/4 bg-luxury-surface p-6 rounded-lg shadow-sm h-fit sticky top-24 border border-luxury-secondary transition-colors duration-300 mx-4 lg:mx-0">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="font-bold tracking-widest uppercase text-sm text-luxury-primary transition-colors">Filters</h3>
                            <button onclick="resetFilters()" class="text-xs text-luxury-accent hover:underline">Reset</button>
                        </div>
                        
                        <!-- Brand Filter -->
                        <div class="mb-6">
                            <label class="block text-xs font-bold text-luxury-text opacity-80 uppercase mb-2 transition-colors">Brand</label>
                            <select onchange="updateFilter('brand', this.value)" class="w-full bg-luxury-base border border-luxury-secondary rounded p-2 text-sm text-luxury-primary focus:border-luxury-accent focus:ring-0 outline-none transition-colors">
                                ${brands.map(b => `<option value="${b}" ${appState.filters.brand === b ? 'selected' : ''}>${b}</option>`).join('')}
                            </select>
                        </div>

                        <!-- Type Filter -->
                        <div class="mb-6">
                            <label class="block text-xs font-bold text-luxury-text opacity-80 uppercase mb-2 transition-colors">Type</label>
                            <div class="space-y-2 text-luxury-primary">
                                ${types.map(t => `
                                    <label class="flex items-center space-x-2 cursor-pointer">
                                        <input type="radio" name="type" value="${t}" onchange="updateFilter('type', this.value)" ${appState.filters.type === t ? 'checked' : ''} class="text-luxury-accent focus:ring-luxury-accent bg-luxury-base border-luxury-secondary">
                                        <span class="text-sm transition-colors">${t}</span>
                                    </label>
                                `).join('')}
                            </div>
                        </div>

                        <!-- Color Filter -->
                        <div class="mb-6">
                            <label class="block text-xs font-bold text-luxury-text opacity-80 uppercase mb-2 transition-colors">Color</label>
                            <div class="flex flex-wrap gap-2">
                                ${colors.filter(c => c !== 'All').map(c => `
                                    <button onclick="updateFilter('color', '${appState.filters.color === c ? 'All' : c}')" 
                                        class="w-6 h-6 rounded-full border ${appState.filters.color === c ? 'ring-2 ring-luxury-accent ring-offset-2 ring-offset-luxury-surface' : 'border-luxury-secondary'}"
                                        style="background-color: ${getColorHex(c)}"
                                        title="${c}"
                                    ></button>
                                `).join('')}
                            </div>
                        </div>

                        <div class="pt-6 border-t border-luxury-secondary transition-colors">
                             <label class="block text-xs font-bold text-luxury-text opacity-80 uppercase mb-2 transition-colors">Sort By</label>
                             <select onchange="updateSort(this.value)" class="w-full bg-luxury-base border border-luxury-secondary rounded p-2 text-sm text-luxury-primary transition-colors">
                                <option value="featured" ${appState.sortBy === 'featured' ? 'selected' : ''}>Featured</option>
                                <option value="priceAsc" ${appState.sortBy === 'priceAsc' ? 'selected' : ''}>Price: Low to High</option>
                                <option value="priceDesc" ${appState.sortBy === 'priceDesc' ? 'selected' : ''}>Price: High to Low</option>
                                <option value="az" ${appState.sortBy === 'az' ? 'selected' : ''}>Name: A - Z</option>
                             </select>
                        </div>
                    </aside>

                    <!-- Product Grid -->
                    <div class="w-full lg:w-3/4 px-4 lg:px-0">
                        <div class="mb-4 text-sm text-luxury-text opacity-80 transition-colors">
                            Showing <span class="font-bold text-luxury-primary">${filteredProducts.length}</span> results
                        </div>
                        
                        ${filteredProducts.length > 0 ? `
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                ${filteredProducts.map(product => createProductCard(product)).join('')}
                            </div>
                        ` : `
                            <div class="flex flex-col items-center justify-center h-64 bg-luxury-surface rounded-lg border border-dashed border-luxury-secondary transition-colors duration-300">
                                <span class="text-4xl mb-4 text-luxury-secondary transition-colors">‚òπ</span>
                                <h3 class="text-lg font-medium text-luxury-text transition-colors">No frames match your criteria.</h3>
                                <button onclick="resetFilters()" class="mt-4 text-luxury-accent underline">Clear all filters</button>
                            </div>
                        `}
                    </div>
                </div>
            `;
        }

        function renderAbout(container) {
            container.innerHTML = `
                <div class="max-w-4xl mx-auto fade-in">
                    <div class="text-center mb-16">
                        <h1 class="text-4xl md:text-5xl font-serif text-luxury-primary mb-6 transition-colors">Built on Trust & Passion</h1>
                        <div class="w-24 h-1 bg-luxury-accent mx-auto"></div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-12 items-center mb-20">
                        <div class="bg-luxury-surface border border-luxury-secondary h-80 rounded-lg flex items-center justify-center transition-colors duration-300">
                            <div class="text-center p-8">
                                <span class="text-6xl text-luxury-primary opacity-20 block mb-4 transition-colors">‚ùù‚ùû</span>
                                <p class="font-serif italic text-luxury-text transition-colors">"Eyewear is not just an accessory. It is the framework through which you see the world."</p>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-2xl font-serif mb-4 text-luxury-primary transition-colors">Our Difference</h3>
                            <p class="text-luxury-text opacity-80 leading-relaxed mb-6 transition-colors">
                                Unlike mass-market retailers, Lumina Optics is a sanctuary for independent eyewear design. 
                                We have spent over two decades cultivating relationships with small-batch artisans in Berlin, Copenhagen, and Italy.
                            </p>
                            <p class="text-luxury-text opacity-80 leading-relaxed transition-colors">
                                We believe in "Slow Fashion" for your face. Every frame in our collection is chosen for its engineering integrity, 
                                material quality, and timeless aesthetic. When you choose Lumina, you aren't just buying glasses; 
                                you are investing in a piece of functional art.
                            </p>
                        </div>
                    </div>

                    <div class="bg-luxury-surface p-8 rounded-lg shadow-sm border-t-4 border-t-luxury-accent border-x border-b border-luxury-secondary transition-colors duration-300">
                        <h3 class="text-xl font-bold mb-6 text-center text-luxury-primary transition-colors">The Lumina Promise</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center">
                            <div>
                                <div class="text-3xl mb-2 text-luxury-primary transition-colors">‚ú¶</div>
                                <h4 class="font-bold text-sm uppercase mb-2 text-luxury-primary transition-colors">Authenticity</h4>
                                <p class="text-sm text-luxury-text opacity-80 transition-colors">Authorized retailer for every brand we carry. 100% genuine.</p>
                            </div>
                            <div>
                                <div class="text-3xl mb-2 text-luxury-primary transition-colors">‚öí</div>
                                <h4 class="font-bold text-sm uppercase mb-2 text-luxury-primary transition-colors">Craftsmanship</h4>
                                <p class="text-sm text-luxury-text opacity-80 transition-colors">We only stock frames made from premium acetate, titanium, and steel.</p>
                            </div>
                            <div>
                                <div class="text-3xl mb-2 text-luxury-primary transition-colors">‚ô•</div>
                                <h4 class="font-bold text-sm uppercase mb-2 text-luxury-primary transition-colors">Care</h4>
                                <p class="text-sm text-luxury-text opacity-80 transition-colors">Lifetime adjustments and comprehensive fitting support.</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderCart(container) {
            if (appState.cart.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-20 fade-in">
                        <h1 class="text-4xl font-serif text-luxury-primary mb-4 transition-colors">Your Cart is Empty</h1>
                        <p class="text-luxury-text opacity-80 mb-8 transition-colors">Discover our collection of premium eyewear to find your perfect frame.</p>
                        <button onclick="navigateTo('shop')" class="bg-luxury-primary text-luxury-base px-8 py-4 font-bold tracking-wider hover:bg-luxury-accent hover:text-white transition-colors duration-300">EXPLORE COLLECTION</button>
                    </div>
                `;
                return;
            }

            const subtotal = appState.cart.reduce((sum, item) => sum + item.price, 0);
            const total = subtotal; // Free shipping

            let cartItemsHTML = appState.cart.map((item, index) => `
                <div class="flex items-center gap-6 border-b border-luxury-secondary py-6 fade-in transition-colors">
                    <div class="w-24 h-24 bg-luxury-secondary/30 flex items-center justify-center rounded border border-luxury-secondary/50 flex-shrink-0 transition-colors">
                        <!-- CSS representation of glasses -->
                        <div style="width: 60px; height: 20px; border: 3px solid ${item.imageColor}; border-radius: ${item.type === 'Sunglasses' ? '5px' : '10px'}; position: relative; display: flex; justify-content: space-between; align-items: center;">
                            <div style="width: 10px; height: 3px; background: ${item.imageColor}; position: absolute; left: 42%; top: 40%;"></div>
                        </div>
                    </div>
                    <div class="flex-grow">
                        <span class="text-xs font-bold text-luxury-text opacity-60 uppercase tracking-wider transition-colors">${item.brand}</span>
                        <h3 class="text-lg font-serif font-bold text-luxury-primary transition-colors">${item.name}</h3>
                        <p class="text-sm text-luxury-text opacity-80 transition-colors">${item.color} | ${item.type}</p>
                    </div>
                    <div class="text-right flex-shrink-0 text-luxury-primary transition-colors">
                        <p class="font-medium text-lg">$${item.price}</p>
                        <button onclick="removeFromCart(${index})" class="text-xs text-red-500 uppercase tracking-widest mt-2 hover:underline">Remove</button>
                    </div>
                </div>
            `).join('');

            container.innerHTML = `
                <div class="max-w-5xl mx-auto fade-in px-4 lg:px-0">
                    <h1 class="text-3xl md:text-4xl font-serif text-luxury-primary mb-10 text-center transition-colors">Your Selection</h1>
                    <div class="flex flex-col lg:flex-row gap-12">
                        <!-- Cart Items -->
                        <div class="w-full lg:w-2/3">
                            ${cartItemsHTML}
                        </div>
                        
                        <!-- Order Summary -->
                        <div class="w-full lg:w-1/3">
                            <div class="bg-luxury-surface p-8 rounded-lg border border-luxury-secondary shadow-sm sticky top-24 transition-colors duration-300">
                                <h3 class="font-bold uppercase tracking-widest text-luxury-primary border-b border-luxury-secondary pb-4 mb-6 transition-colors">Order Summary</h3>
                                
                                <div class="flex justify-between mb-4 text-luxury-text transition-colors">
                                    <span>Subtotal (${appState.cart.length} item${appState.cart.length !== 1 ? 's' : ''})</span>
                                    <span>$${subtotal.toFixed(2)}</span>
                                </div>
                                <div class="flex justify-between mb-6 text-luxury-text transition-colors">
                                    <span>Standard Shipping</span>
                                    <span class="text-luxury-accent font-medium">Complimentary</span>
                                </div>
                                
                                <div class="flex justify-between border-t border-luxury-secondary pt-6 mb-8 font-serif font-bold text-2xl text-luxury-primary transition-colors">
                                    <span>Total</span>
                                    <span>$${total.toFixed(2)}</span>
                                </div>
                                
                                <button class="w-full bg-luxury-primary text-luxury-base py-4 font-bold tracking-wider hover:bg-luxury-accent hover:text-white transition-colors duration-300">
                                    SECURE CHECKOUT
                                </button>
                                
                                <div class="mt-6 text-center text-xs text-luxury-text opacity-60 flex justify-center items-center gap-2 transition-colors">
                                    <span class="text-lg">üîí</span> <span>Encrypted Transaction</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderStylist(container) {
            container.innerHTML = `
                <div class="max-w-4xl mx-auto fade-in px-4 lg:px-0">
                    <div class="text-center mb-10">
                        <h1 class="text-4xl font-serif text-luxury-primary mb-4 flex justify-center items-center gap-3 transition-colors">
                            <span class="text-luxury-accent">‚ú®</span> Personal AI Stylist
                        </h1>
                        <p class="text-luxury-text opacity-80 max-w-2xl mx-auto transition-colors">
                            Describe your facial features, personal style, and what you're looking for. 
                            Our AI will curate the perfect frames from our collection just for you.
                        </p>
                    </div>

                    <div class="bg-luxury-surface p-8 rounded-lg shadow-sm border border-luxury-secondary mb-10 transition-colors duration-300">
                        <textarea id="stylePrompt" rows="4" class="w-full bg-luxury-base border border-luxury-secondary rounded p-4 text-sm text-luxury-primary focus:border-luxury-accent focus:ring-1 focus:ring-luxury-accent outline-none transition-all resize-none mb-4" placeholder="E.g., I have a square face and I work in a creative agency. I want something bold but professional, preferably in a dark color..."></textarea>
                        <button id="stylistBtn" onclick="handleStyleSubmit()" class="w-full bg-luxury-primary text-luxury-base py-4 font-bold tracking-wider hover:bg-luxury-accent hover:text-white transition-colors duration-300 flex justify-center items-center gap-2">
                            <span>DISCOVER MY FRAMES</span> <span class="text-xl">‚ú®</span>
                        </button>
                    </div>

                    <div id="stylistResults" class="hidden">
                        <!-- Results injected here -->
                    </div>
                </div>
            `;
        }

        async function handleStyleSubmit() {
            const promptInput = document.getElementById('stylePrompt').value;
            const resultsDiv = document.getElementById('stylistResults');
            const btn = document.getElementById('stylistBtn');

            if (!promptInput.trim()) return;

            // Loading state
            btn.disabled = true;
            btn.innerHTML = `<svg class="animate-spin h-5 w-5 text-current" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> <span>CURATING YOUR LOOK...</span>`;
            resultsDiv.classList.remove('hidden');
            resultsDiv.innerHTML = `
                <div class="flex flex-col items-center justify-center py-12 text-luxury-text opacity-70 fade-in transition-colors">
                    <div class="text-4xl mb-4 animate-pulse">‚ú®</div>
                    <p class="tracking-widest text-sm uppercase">Analyzing profile...</p>
                </div>
            `;

            try {
                // Prepare context for the LLM
                const inventoryJSON = JSON.stringify(products.map(p => ({
                    id: p.id, brand: p.brand, name: p.name, type: p.type, color: p.color, material: p.material
                })));

                const systemInstruction = `You are an elite, high-end eyewear stylist at Lumina Optics. 
                Based on the user's description of their style, face shape, and needs, select 2 to 3 frames from our inventory that fit them best.
                Inventory: ${inventoryJSON}
                Be luxurious, confident, and highly personalized in your 'introMessage'. Explain exactly why each frame works for them in the 'reason'.`;

                const payload = {
                    contents: [{ parts: [{ text: promptInput }] }],
                    systemInstruction: { parts: [{ text: systemInstruction }] },
                    generationConfig: {
                        responseMimeType: "application/json",
                        responseSchema: {
                            type: "OBJECT",
                            properties: {
                                introMessage: { type: "STRING" },
                                recommendations: {
                                    type: "ARRAY",
                                    items: {
                                        type: "OBJECT",
                                        properties: {
                                            productId: { type: "INTEGER" },
                                            reason: { type: "STRING" }
                                        }
                                    }
                                }
                            }
                        }
                    }
                };

                const response = await fetchWithRetry(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const data = await response.json();
                if (data.error) throw new Error(data.error.message);
                
                const aiResult = JSON.parse(data.candidates[0].content.parts[0].text);

                // Render Results
                let recommendationsHTML = aiResult.recommendations.map(rec => {
                    const product = products.find(p => p.id === rec.productId);
                    if (!product) return '';
                    return `
                        <div class="flex flex-col md:flex-row gap-8 bg-luxury-surface p-6 rounded-lg border border-luxury-secondary shadow-sm mb-6 fade-in transition-colors duration-300">
                            <div class="w-full md:w-1/3">
                                ${createProductCard(product)}
                            </div>
                            <div class="w-full md:w-2/3 flex flex-col justify-center">
                                <h4 class="font-serif text-xl text-luxury-primary mb-3 transition-colors">Why this fits you:</h4>
                                <p class="text-luxury-text opacity-90 leading-relaxed italic border-l-2 border-luxury-accent pl-5 py-2 transition-colors">"${rec.reason}"</p>
                            </div>
                        </div>
                    `;
                }).join('');

                resultsDiv.innerHTML = `
                    <div class="fade-in mb-10">
                        <div class="bg-luxury-secondary/20 p-8 rounded-lg border-t-4 border-luxury-accent transition-colors duration-300">
                            <p class="font-serif text-xl leading-relaxed text-luxury-primary transition-colors">"${aiResult.introMessage}"</p>
                            <p class="text-sm font-bold tracking-widest uppercase mt-4 text-luxury-accent">‚Äî Your Virtual Stylist</p>
                        </div>
                    </div>
                    <div>${recommendationsHTML}</div>
                `;

            } catch (error) {
                console.error("Gemini API Error:", error);
                resultsDiv.innerHTML = `
                    <div class="bg-red-500/10 text-red-500 p-4 rounded text-center border border-red-500/20 transition-colors">
                        We apologize, but our stylist is currently unavailable. Please try again later.
                    </div>
                `;
            } finally {
                btn.disabled = false;
                btn.innerHTML = `<span>DISCOVER MY FRAMES</span> <span class="text-xl">‚ú®</span>`;
            }
        }

        async function fetchWithRetry(url, options, retries = 5) {
            const delays = [1000, 2000, 4000, 8000, 16000];
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    return response;
                } catch (e) {
                    if (i === retries - 1) throw e;
                    await new Promise(res => setTimeout(res, delays[i]));
                }
            }
        }

        // --- HELPER FUNCTIONS ---

        function createProductCard(product) {
            return `
                <div class="group bg-luxury-surface rounded-lg border border-luxury-secondary overflow-hidden hover:shadow-lg transition-all duration-300">
                    <!-- Simulated Image Area -->
                    <div class="h-56 w-full flex items-center justify-center relative overflow-hidden bg-luxury-secondary/30 transition-colors">
                         <!-- Visual representation of the glasses using CSS shapes/colors -->
                         <div class="transition-transform duration-500 transform group-hover:scale-110">
                            <div style="
                                width: 140px; 
                                height: 50px; 
                                border: 4px solid ${product.imageColor}; 
                                border-radius: ${product.type === 'Sunglasses' ? '10px' : '20px'};
                                position: relative;
                                box-shadow: 2px 4px 10px rgba(0,0,0,0.1);
                                display: flex;
                                justify-content: space-between;
                                align-items: center;
                            ">
                                <div style="width: 20px; height: 4px; background: ${product.imageColor}; position: absolute; left: 45%; top: 40%;"></div> <!-- Bridge -->
                            </div>
                            <div class="mt-4 text-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                                <span class="bg-luxury-primary text-luxury-base text-xs px-2 py-1 uppercase tracking-widest transition-colors">Quick View</span>
                            </div>
                         </div>
                    </div>
                    
                    <div class="p-6">
                        <div class="flex justify-between items-start mb-2">
                            <span class="text-xs font-bold text-luxury-text opacity-60 uppercase tracking-wider transition-colors">${product.brand}</span>
                            <span class="text-sm font-medium text-luxury-accent">$${product.price}</span>
                        </div>
                        <h3 class="text-lg font-serif font-bold text-luxury-primary mb-1 transition-colors">${product.name}</h3>
                        <p class="text-sm text-luxury-text opacity-80 mb-4 transition-colors">${product.color} | ${product.material}</p>
                        
                        <button onclick="addToCart(${product.id})" class="w-full border border-luxury-primary text-luxury-primary py-2 text-sm uppercase font-bold hover:bg-luxury-primary hover:text-luxury-base transition-colors duration-300">
                            Add to Cart
                        </button>
                    </div>
                </div>
            `;
        }

        // --- CART LOGIC ---

        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            if (product) {
                appState.cart.push(product);
                updateCartCount();
                showToast(product);
            }
        }

        function removeFromCart(index) {
            appState.cart.splice(index, 1);
            updateCartCount();
            renderCart(document.getElementById('app-content'));
        }

        function updateCartCount() {
            const badges = document.querySelectorAll('.cart-count-badge');
            badges.forEach(badge => {
                badge.innerText = appState.cart.length;
                if (appState.cart.length > 0) {
                    badge.classList.remove('hidden');
                } else {
                    badge.classList.add('hidden');
                }
            });

            // Handle Mobile Menu Cart Item visibility
            const mobileCartBtn = document.getElementById('mobile-cart-menu-item');
            const mobileCartCount = document.getElementById('mobile-cart-count');
            if (mobileCartBtn && mobileCartCount) {
                mobileCartCount.innerText = appState.cart.length;
                if (appState.cart.length > 0) {
                    mobileCartBtn.classList.remove('hidden');
                    mobileCartBtn.classList.add('flex');
                } else {
                    mobileCartBtn.classList.add('hidden');
                    mobileCartBtn.classList.remove('flex');
                }
            }
        }

        function showToast(product) {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            
            // Tailwind classes for styling the toast
            toast.className = 'bg-luxury-primary text-luxury-base p-4 rounded-sm shadow-2xl flex items-center gap-4 transform transition-all duration-500 translate-y-10 opacity-0 min-w-[300px] border-l-4 border-luxury-accent';
            
            toast.innerHTML = `
                <div class="w-12 h-12 bg-luxury-surface rounded flex items-center justify-center flex-shrink-0 transition-colors">
                    <div style="width: 24px; height: 8px; border: 2px solid ${product.imageColor}; border-radius: 3px; position: relative;">
                         <div style="width: 4px; height: 1px; background: ${product.imageColor}; position: absolute; left: 40%; top: 40%;"></div>
                    </div>
                </div>
                <div class="flex-grow">
                    <p class="text-[10px] uppercase tracking-widest text-luxury-accent font-bold mb-1">Added to Cart</p>
                    <p class="font-serif text-sm">${product.name}</p>
                </div>
                <button onclick="navigateTo('cart'); this.parentElement.remove()" class="text-xs font-bold underline text-luxury-base hover:text-luxury-accent transition-colors ml-4 uppercase tracking-wider">
                    View
                </button>
            `;
            
            container.appendChild(toast);
            
            // Trigger animation in
            requestAnimationFrame(() => {
                toast.classList.remove('translate-y-10', 'opacity-0');
            });

            // Remove toast automatically after 4 seconds
            setTimeout(() => {
                toast.classList.add('opacity-0', 'translate-y-2');
                setTimeout(() => toast.remove(), 500); // wait for fade out
            }, 4000);
        }

        function getColorHex(colorName) {
            const map = {
                'Black': '#000000',
                'Gold': '#D4AF37',
                'Tortoise': '#5C4033',
                'Silver': '#C0C0C0',
                'Blue': '#1E3A8A'
            };
            return map[colorName] || '#CCCCCC';
        }

        function updateFilter(key, value) {
            appState.filters[key] = value;
            renderShop(document.getElementById('app-content'));
        }

        function updateSort(value) {
            appState.sortBy = value;
            renderShop(document.getElementById('app-content'));
        }

        function resetFilters() {
            appState.filters = { brand: 'All', color: 'All', type: 'All' };
            appState.sortBy = 'featured';
            renderShop(document.getElementById('app-content'));
        }

        function toggleMobileFilters() {
            const filters = document.getElementById('shopFilters');
            filters.classList.toggle('hidden');
        }

        // --- INITIALIZATION ---
        window.onload = function() {
            updateThemeIcons();
            updateCartCount();
            renderPage('home');
        };

    </script>
</body>
</html>
